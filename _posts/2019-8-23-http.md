---
layout: post
title: " Httpçš„æ¼”åŒ– Http1.1 Http2.0 Http3.0"
date:   2019-8-23
tags: [network]
comments: true
author: zhang
---
why tcp and http donot like each other  

<img width="561" alt="image" src="https://github.com/zhang-mickey/zhang-mickey.github.io/assets/145342600/ffe2d732-63bb-45eb-8a40-42e60a6060c6">

**HTTP/2çš„å¤šè·¯å¤ç”¨å’ŒHTTP/1.Xä¸­çš„é•¿è¿æ¥å¤ç”¨çš„åŒºåˆ«**

HTTP/1.X ä¸€æ¬¡è¯·æ±‚-å“åº”ï¼Œå»ºç«‹ä¸€ä¸ªè¿æ¥ï¼Œç”¨å®Œå…³é—­ï¼›æ¯ä¸€ä¸ªè¯·æ±‚éƒ½è¦å»ºç«‹ä¸€ä¸ªè¿æ¥ï¼›
HTTP/1.1 Pipelingè§£å†³æ–¹å¼ä¸ºï¼Œè‹¥å¹²ä¸ªè¯·æ±‚æ’é˜Ÿä¸²è¡ŒåŒ–å•çº¿ç¨‹å¤„ç†ï¼Œåé¢çš„è¯·æ±‚ç­‰å¾…å‰é¢è¯·æ±‚çš„è¿”å›æ‰èƒ½è·å¾—æ‰§è¡Œæœºä¼šï¼Œä¸€æ—¦æœ‰æŸè¯·æ±‚è¶…æ—¶ç­‰ï¼Œåç»­è¯·æ±‚åªèƒ½è¢«é˜»å¡ï¼Œæ¯«æ— åŠæ³•ï¼Œä¹Ÿå°±æ˜¯äººä»¬å¸¸è¯´çš„çº¿å¤´é˜»å¡ï¼›
HTTP/2å¤šä¸ªè¯·æ±‚å¯åŒæ—¶åœ¨ä¸€ä¸ªè¿æ¥ä¸Šå¹¶è¡Œæ‰§è¡Œã€‚æŸä¸ªè¯·æ±‚ä»»åŠ¡è€—æ—¶ä¸¥é‡ï¼Œä¸ä¼šå½±å“åˆ°å…¶å®ƒè¿æ¥çš„æ­£å¸¸æ‰§è¡Œï¼›

## HTTP 0.9æœ€åˆç‰ˆ
åªæ”¯æŒgetè¯·æ±‚
Server response is in HTML
ä¸€ä¸ªè¯·æ±‚éœ€è¦ä¸€ä¸ªè¿æ¥
<img width="575" alt="image" src="https://github.com/zhang-mickey/zhang-mickey.github.io/assets/145342600/3b351bf4-6a2d-45b1-9d93-ea9111b475d1">
## HTTP/1.0
ä¼ è¾“çš„æ•°æ®ä¸å†å±€é™äºæ–‡æœ¬  
Connection between server and client is closed after each request  
æ¯ä¸€ä¸ªTCPè¿æ¥åªèƒ½å‘é€ä¸€ä¸ªHTTPè¯·æ±‚ï¼ŒæœåŠ¡å™¨å‘é€å®Œå“åº”ï¼Œå°±å…³é—­è¿æ¥ã€‚å¦‚æœåé¢éœ€è¦è¯·æ±‚æ–°çš„æ•°æ®ï¼Œåˆ™éœ€è¦å†æ¬¡å»ºç«‹TCPè¿æ¥ï¼Œä½†æ˜¯TCPå»ºç«‹è¿æ¥çš„ä¸‰æ¬¡æ¡æ‰‹æˆæœ¬æ¯”è¾ƒé«˜ï¼Œå¹¶ä¸”TCPè¿æ¥åˆå§‹çš„æ—¶å€™å‘é€æ•°æ®çš„é€Ÿåº¦ç›¸å¯¹è¾ƒæ…¢ï¼Œæœ‰ä¸€ä¸ªæ…¢å¯åŠ¨å’Œæ‹¥å¡é¿å…çš„é˜¶æ®µã€‚
æç«¯æƒ…å†µï¼Œå¦‚æœæ¯æ¬¡è¯·æ±‚çš„æ•°æ®å¾ˆå°‘ï¼Œä½†æ˜¯è¯·æ±‚å¾ˆé¢‘ç¹ï¼Œè¿™æ ·æ¯æ¬¡è¯·æ±‚å¾ˆå°‘çš„æ•°æ®éƒ½éœ€è¦å»ºç«‹è¿æ¥ç„¶åæ–­å¼€ã€‚

## HTTP1.1
é•¿è¿æ¥ï¼šå¼•å…¥äº† TCP è¿æ¥å¤ç”¨ï¼Œå³ä¸€ä¸ª TCP é»˜è®¤ä¸å…³é—­ï¼Œå¯ä»¥è¢«å¤šä¸ªè¯·æ±‚å¤ç”¨  
æŒä¹…è¿æ¥ä¸‹ä¸€ä¸ªè¿æ¥ä¸­çš„è¯·æ±‚ä»ç„¶æ˜¯ä¸²è¡Œçš„ï¼Œå¦‚æœæŸä¸ªè¯·æ±‚å‡ºç°ç½‘ç»œé˜»å¡ç­‰é—®é¢˜ï¼Œä¼šå¯¼è‡´åŒä¸€æ¡è¿æ¥ä¸Šçš„åç»­è¯·æ±‚è¢«é˜»å¡ã€‚   
æ‰€ä»¥HTTP/1.1ä¸­æå‡ºäº†pipeliningæ¦‚å¿µ  
### pipelining
å¼•å…¥äº†ç®¡é“æœºåˆ¶ï¼Œå³åœ¨åŒä¸€ä¸ªTCPè¿æ¥é‡Œé¢ï¼Œå¤šä¸ªHTTPè¯·æ±‚å¯ä»¥å¹¶è¡Œ(åŒä¸ªåŸŸåã€åŒä¸€æ¡ TCP é“¾æ¥)ï¼Œå®¢æˆ·ç«¯ä¸ç”¨ç­‰å¾…ä¸Šä¸€æ¬¡è¯·æ±‚ç»“æœè¿”å›,å°±å¯ä»¥å‘å‡ºä¸‹ä¸€æ¬¡è¯·æ±‚ï¼ˆå“åº”çš„é¡ºåºå¿…é¡»å’Œè¯·æ±‚çš„é¡ºåºä¸€è‡´ï¼Œå› æ­¤ä¸å¸¸ç”¨ï¼‰.    
ä½†è¿™è¦æ±‚æœåŠ¡ç«¯å¿…é¡»æŒ‰ç…§è¯·æ±‚å‘é€çš„é¡ºåºè¿”å›å“åº”ï¼Œä»¥ä¿è¯å®¢æˆ·ç«¯èƒ½ å¤ŸåŒºåˆ†å‡ºæ¯æ¬¡è¯·æ±‚çš„å“åº”å†…å®¹ã€‚å½“é¡ºåºè¯·æ±‚å¤šä¸ªæ–‡ä»¶æ˜¯ï¼Œå…¶ä¸­æŸä¸ªè¯·æ±‚è¢«é˜»å¡æ—¶ï¼Œåœ¨å…¶åçš„æ‰€æœ‰è¯·æ±‚ä¹Ÿä¸€å¹¶è¢«é˜»å¡ï¼Œè¿™å°±æ˜¯é˜Ÿå¤´é˜»å¡ï¼ˆï¼‰  
problem:lack of multiplexing in http ğŸ¥‡  
(1)signel,large request can bblock all others  
(2)single,failing request can terminate whole pipeline  

## HTTP2.0
å®¢æˆ·ç«¯åœ¨å‘é€è¯·æ±‚æ—¶ä¼šå°†æ¯ä¸ªè¯·æ±‚çš„å†…å®¹å°è£…æˆä¸åŒçš„å¸¦æœ‰ç¼–å·çš„äºŒè¿›åˆ¶å¸§ï¼ˆFrameï¼‰ï¼Œç„¶åå°†è¿™äº›å¸§åŒæ—¶å‘é€ç»™æœåŠ¡ç«¯ã€‚æœåŠ¡ç«¯æ¥æ”¶åˆ°æ•°æ®ä¹‹åï¼Œä¼šå°†ç›¸åŒç¼–å·çš„å¸§åˆå¹¶ä¸ºå®Œæ•´çš„è¯·æ±‚ä¿¡æ¯ã€‚
åŒæ ·ï¼ŒæœåŠ¡ç«¯è¿”å›ç»“æœã€å®¢æˆ·ç«¯æ¥æ”¶ç»“æœä¹Ÿéµå¾ªè¿™ä¸ªå¸§çš„æ‹†åˆ†ä¸ç»„åˆçš„è¿‡ç¨‹ã€‚
æœ‰äº†äºŒè¿›åˆ¶åˆ†å¸§åï¼Œå¯¹äºåŒä¸€ä¸ªåŸŸï¼Œå®¢æˆ·ç«¯åªéœ€è¦ä¸æœåŠ¡ç«¯å»ºç«‹ä¸€ä¸ªè¿æ¥å³å¯å®Œæˆé€šä¿¡éœ€æ±‚ï¼Œè¿™ç§åˆ©ç”¨ä¸€ä¸ªè¿æ¥æ¥å‘é€å¤šä¸ªè¯·æ±‚çš„æ–¹å¼ç§°ä¸ºå¤šè·¯å¤ç”¨ã€‚æ¯ä¸€æ¡è·¯éƒ½è¢«ç§°ä¸ºä¸€ä¸ª streamï¼ˆæµï¼‰.

å¤šè·¯å¤ç”¨ï¼ˆmultiplexingï¼‰ï¼š åºŸå¼ƒäº† HTTP/1.1 ä¸­çš„ç®¡é“ï¼ŒåŒä¸€ä¸ªTCPè¿æ¥é‡Œé¢ï¼Œå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨å¯ä»¥åŒæ—¶å‘é€å¤šä¸ªè¯·æ±‚å’Œå¤šä¸ªå“åº”ï¼Œå¹¶ä¸”ä¸ç”¨æŒ‰ç…§é¡ºåºæ¥,é€šè¿‡streamIdæ¥äº’ç›¸åŒºåˆ«ã€‚ç”±äºæœåŠ¡å™¨ä¸ç”¨æŒ‰é¡ºåºæ¥å¤„ç†å“åº”ï¼Œæ‰€ä»¥é¿å…äº†â€œå¯¹å¤´å µå¡â€çš„é—®é¢˜ã€‚ä½†åœ¨TCPåè®®çº§åˆ«ä¸Šä»ç„¶å­˜åœ¨ç±»ä¼¼çš„é˜Ÿå¤´é—®é¢˜  
Http2.0 solves HTTP head of line blocking, but still suffer from TCP head-of-line blocking  



## HTTP3.0
HTTP3 èƒŒåçš„ä¸»è¦æ€æƒ³æ˜¯æ”¾å¼ƒ TCPï¼Œè½¬è€Œä½¿ç”¨åŸºäº UDP çš„ QUIC ï¼ˆå¿«é€ŸUDPäº’è”ç½‘è¿æ¥ï¼‰åè®®ã€‚


### video streaming   
- unsupported format  
- missing plugins  
- long start-up time  
- low quality  
- frequent stalls  


#### Performance struggles with videl streaming  
Understand the problems of traditional video streaming  
#### Dynamic Adaptive Streaming over HTTP(DASH)
DASH enables adaptive bitrate streaming, where the video quality is adjusted dynamically based on the viewer's network conditions. This ensures a smooth viewing experience by adapting to changes in available bandwidth.

##### Adaptive Bitrate Streaming è‡ªé€‚åº”æ¯”ç‰¹ç‡ä¼ è¾“
a video file is split up into segments,typically with a duration between two and ten seconds. Each segment is encoded at several bitrates.  
A manifest file describes what the order and bitrate of the segment is.  
The video player processes this manifest file, and requests segments of a certain bitrate according to its own measurements ofthe available bandwidth.  
å‘ç”¨æˆ·çš„è§†é¢‘æ’­æ”¾å™¨æä¾›å¤šä¸ªç›¸åŒå†…å®¹ã€ä¸åŒå¤§å°æ–‡ä»¶çš„æ–‡ä»¶ï¼Œç„¶åå®¢æˆ·ç«¯é€‰æ‹©æœ€åˆé€‚çš„æ–‡ä»¶åœ¨è®¾å¤‡ä¸Šæ’­æ”¾ã€‚  
è‡ªé€‚åº”æ¯”ç‰¹ç‡æµåŠ¨æ€è·Ÿè¸ª CPUã€å†…å­˜å®¹é‡å’Œç½‘ç»œçŠ¶å†µï¼Œç„¶åæä¾›åŒ¹é…çš„è§†é¢‘è´¨é‡  
æºè§†é¢‘åœ¨æœåŠ¡å™¨ç«¯ä»¥ä¸åŒçš„æ¯”ç‰¹ç‡ç¼–ç ï¼Œç„¶åå°†è¿™äº›è§†é¢‘æ–‡ä»¶åˆ†æˆå°æ®µ  

### Push-based video streaming 
Server pushes stream to client,client acknowledges recption  
Adaptation based on how many packets are received  
**Continuous flow** from server to client  
- scalability(Video stream always comes from HTTP server)  
- Implementation(manual configuration ofthen required, firewalls may block UDP traffic)


### Pull-based video streaming  
DASH client requests video segments from HTTP server   
Client re-assembles segments to form a video stream  
**Flexibility**:each segment can come from a different server  
**Scalability**:Server is dumb and state-less  
- Use of existing infrastructure
- HTTp traversrs firewalls without problems
- On-demand,live and time-shift streaming
### Self optimization problem
Bandwidth measurements might be wrong  

### observing performance problem  
many switches in bitrate  
unfair sharing of bandwidth  

https://juejin.cn/post/7079936383925616653
